<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">

<!-- 여행 페이지 -->
<select id="getMyTravelCount" parameterType="travelBoard" resultType="int">
	SELECT COUNT(*)
	  FROM TRAVELBOARDT
	 WHERE USER_ID = #{userId}
</select>
<select id="getMyTravelList" parameterType="travelBoard" resultType="travelBoard">
SELECT B.* FROM ( SELECT A.*, ROWNUM RN FROM ( 
	SELECT  TRAVEL_NO,
			TRAVEL_TITLE,
			TRAVEL_CONTENT,
			TRAVEL_PIC,
			TO_CHAR(TRAVEL_DATE,'YYYY/MM/DD') TRAVEL_DATE,
			TRAVEL_HIT,
			TRAVEL_LIKE,
			USER_ID
	  FROM  TRAVELBOARDT
	  WHERE USER_ID = #{userId}
   ORDER BY TRAVEL_NO DESC
) A ) B WHERE RN BETWEEN #{first} AND #{last}
</select>
<delete id="deleteMyTravelList" parameterType="travelBoard">
	DELETE  FROM TRAVELBOARDT
	<if test="travelNoList != null and travelNoList.length > 0">
		WHERE TRAVEL_NO in
	<foreach collection="travelNoList" item="item"
			open="(" close=")" separator=",">
		#{item}
	</foreach>
	</if>
	<if test="travelNoList == null or not travelNoList.length > 0">
		WHERE TRAVEL_NO = -1
	</if>
</delete>

<!-- 동행 페이지 -->
<select id="getMyPartnerList" parameterType="partner" resultType="partner">
	SELECT  PARTNER_ID,
			PARTNER_TITLE,
			TO_CHAR(PARTNER_DATE, 'MM/DD') PARTNER_DATE,
			USER_ID,
			PARTNER_CONDITION
	  FROM  PARTNERT
	  WHERE USER_ID = #{userId}
   ORDER BY PARTNER_DATE DESC
</select>
<select id="getMyJoinerList" parameterType="joiner" resultType="joiner">
	SELECT	JOINER_ID,
			JOINER_DATE,
			J.USER_ID,
			J.PARTNER_ID,
			JOINER_CONDITION
	FROM	JOINERT J, PARTNERT P
	WHERE	J.PARTNER_ID = P.PARTNER_ID
			AND P.USER_ID = #{userId}
   ORDER BY JOINER_DATE DESC
</select>

<!-- 좋아요 페이지 -->
<select id="getMyLikedList" parameterType="user" resultType="user">
</select>
<select id="getMyULikeList" parameterType="user" resultType="user">
</select>

<!-- 상품 페이지 -->
<select id="getMyProductCount" parameterType="product" resultType="int">
	SELECT COUNT(*)
	  FROM ITEMT
	 WHERE SELLER_ID = #{sellerId}
</select>
<select id="getMyProductList" parameterType="product" resultType="product">
SELECT B.* FROM ( SELECT A.*, ROWNUM RN FROM ( 
	SELECT  ITEM_ID,
			ITEM_NAME,
			ITEM_PRICE,
			ITEM_CONTENT,
			ITEM_CATEGORY,
			SELLER_ID,
			ITEM_ORDERDETAIL,
			ITEM_STAR,
			ITEM_PIC,
			TO_CHAR(ITEM_DATE, 'YYYY/MM/DD') ITEM_DATE,
			ITEM_LIKE
	   FROM ITEMT
	  WHERE SELLER_ID = #{sellerId}
   ORDER BY ITEM_ID DESC
) A ) B WHERE RN BETWEEN #{first} AND #{last}
</select>
<delete id="deleteMyProductList" parameterType="product">
	DELETE  FROM ITEMT
	<if test="itemNoList != null and itemNoList.length > 0">
	  WHERE ITEM_ID in
	<foreach collection="itemNoList" item="item"
			open="(" close=")" separator=",">
		#{item}
	</foreach>
	</if>
	<if test="itemNoList == null or not itemNoList.length > 0">
		WHERE ITEM_ID = -1
	</if>
</delete>

<!-- 거래내역 페이지 -->
<select id="getMyOrderCount" parameterType="order" resultType="int">
	SELECT COUNT(*)
	  FROM ORDERV
	 WHERE BUYER_ID = #{buyerId}
</select>
<select id="getMyOrderList" parameterType="order" resultType="order">
SELECT B.* FROM ( SELECT A.*, ROWNUM RN FROM ( 
	SELECT ORDER_ID,
		   TO_CHAR(ORDER_DATE, 'YYYY/MM/DD') ORDER_DATE,
		   ORDER_CONDITION,
		   ORDER_DELIVERY,
		   ORDER_PRICE,
		   ORDER_EA,
		   ITEM_ID,
		   ITEM_NAME,
		   ITEM_METHOD,
		   ITEM_DELIVERYNO,
		   BUYER_ID
	  FROM ORDERV
	 WHERE BUYER_ID = #{buyerId}
  ORDER BY ORDER_DATE DESC
) A ) B WHERE RN BETWEEN #{first} AND #{last}
</select>
<select id="getMyOrder" parameterType="order" resultType="order">
	SELECT ORDER_ID,
		   TO_CHAR(ORDER_DATE, 'YYYY/MM/DD') ORDER_DATE,
		   ORDER_CONDITION,
		   ORDER_DELIVERY,
		   ORDER_PRICE,
		   ORDER_EA,
		   ITEM_ID,
		   ITEM_NAME,
		   ITEM_METHOD,
		   ITEM_DELIVERYNO,
		   BUYER_ID
	  FROM ORDERV
	 WHERE ORDER_ID = #{orderId}
</select>
<delete id="deleteMyOrderList" parameterType="order">
	DELETE  FROM ORDERT
	<if test="orderNoList != null and orderNoList.length > 0">
	  WHERE ORDER_ID in
	<foreach collection="orderNoList" item="item"
			open="(" close=")" separator=",">
		#{item}
	</foreach>
	</if>
	<if test="orderNoList == null or not orderNoList.length > 0">
		WHERE ORDER_ID = -1
	</if>
</delete>

<!-- 리뷰 페이지 -->
<select id="getMyReviewCount" parameterType="order" resultType="int">
	SELECT COUNT(*)
	  FROM REVIEWV
	 WHERE BUYER_ID = #{buyerId}
</select>
<select id="getMyReviewList" parameterType="order" resultType="order">
	SELECT BUYER_ID,
		   REVIEW_STAR,
		   REVIEW_CONTENT,
		   TO_CHAR(REVIEW_DATE, 'YYYY/MM/DD') REVIEW_DATE,
		   REVIEW_PIC,
		   ITEM_NAME,
		   ORDER_EA
	  FROM REVIEWV
	 WHERE BUYER_ID = #{buyerId}
  ORDER BY REVIEW_DATE DESC
</select>
<update id="deleteMyReviewList" parameterType="order">
	UPDATE ORDERT SET REVIEW_STAR = NULL,
					  REVIEW_CONTENT = NULL,
					  REVIEW_DATE = NULL,
					  REVIEW_PIC = NULL
	  			WHERE ORDER_ID = #{orderId}
</update>
</mapper>